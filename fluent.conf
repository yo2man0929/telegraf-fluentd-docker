<source>
  @type forward
  port 24224
  bind 0.0.0.0
</source>

<filter **>
    @type parser
    key_name log
    reserve_data false
    remove_key_name_field true
    <parse>
        @type regexp
        expression /(?<timestamp>\S*)\sprovider=(?<cyang02>\d*) array=(?<ehuang02>\w+)/
        # expression /^\[(?<logTime>.+)\]\s+(?<logMessage>.+)$/
        time_key logTime
        time_format %a %d %b %Y %T,000 %z
        types cyang02:integer,timestamp:integer
    </parse>
</filter>
<filter **>
  @type record_transformer
  enable_ruby true
  renew_record true
  auto_typecast true
  <record>
    dimensions ${{"user" => record['ehuang02']}}
    metrics ${{"value" => record['cyang02']}}
    application "ecs_fluentd"
    TimestampSec ${record["timestamp"]}
  </record>
</filter>



<match **>
@type copy 
<store>
  @type http
  endpoint_url  http://telegraf-docker:4080/test
  ssl_no_verify   false  # default: false
  http_method     put    # default: post
  serializer      json  # default: form
  recoverable_status_codes 503, 400 # default: 503
  buffered        true 
  bulk_request    true 
</store>
<store>
@type stdout
</store>
</match>
